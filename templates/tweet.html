<div id="tweetContainer-{{tweet.tweet.id}}"
     style="width: 60%; background-color: #1e242d; color: #1d1f21; border-radius: 12px; padding: 20px; margin: 15px auto; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);">
    <div style="display: flex; justify-content: space-between">
        <div style="display: flex; align-items: center; margin-bottom: 12px;">
            <img src={{tweet.tweet.user.profilePic}} alt="Profile Picture"
                 style="border-radius: 50%; height: 48px; margin-right: 15px;">
            <div>
                <h3 style="font-size: 18px; color: #f0f1f3; margin: 0; font-weight: bold;">
                    {{tweet.tweet.user.username}}</h3>
                <span style="color: #4f8a8b; font-size: 15px;">Member Since: {{tweet.tweet.user.joined_date}}</span>
            </div>
        </div>
        <div style="display: flex; align-items: flex-start; gap: 10px;">
            <span class="time" style="color: #4f8a8b; font-size: 15px;">{{tweet.tweet.post_date}}</span>

            {% if tweet.tweet.user.userID == user.userID and editPageOpen == True %}
            <div style="position: relative; cursor: pointer; text-align: right; display: flex; flex-direction: column; align-items: flex-start;">
                <div class="dropdown">
                    <button onclick="toggleDropdown(event, this)"
                            style="background: none; border: none; display: inline-block; outline: none; height: 24px; padding: 0; margin: 0; align-self: flex-start;">
                        <img src="/img/drag-vertical-svgrepo-com.svg" style="height: 24px;" alt="Three Dot Icon"/>
                    </button>

                    <div class="content">
                        <input type="hidden" name="message" value="{{tweet.tweet.message}}">
                        <button hx-get="/tweets/editMessage/{{True}}/{{tweet.tweet.id}}"
                                hx-target="#tweet-text-{{ tweet.tweet.id }}"
                                hx-swap="innerHTML">
                            EDIT
                        </button>

                        <form hx-delete="/delete/{{tweet.tweet.id}}"
                              hx-target="#tweetContainer-{{tweet.tweet.id}}"
                              hx-swap="outerHTML">
                            <button type="submit" style="color: red; margin-bottom: 0; padding-bottom: 12px">
                                DELETE
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <p id="tweet-text-{{ tweet.tweet.id }}"
       style="font-size: 18px; line-height: 1.6; font-weight: bold; color: #f0f1f3;">
        {{tweet.tweet.message}}
    </p>

    <div style=" display: flex; justify-content: space-between; align-items: center; margin-top: 10px; border-top: grey 1px solid; padding-top: 10px;">
        <div id="like-count-{{ tweet.tweet.id }}" style="display: flex; align-items: center; gap: 5px;">
            <button
                    hx-post="/tweets/{{ tweet.tweet.id }}/like"
                    hx-target="#like-count-{{ tweet.tweet.id }}"
                    hx-swap="outerHTML" style="all:unset; cursor: pointer">
                {{tweet.heart_icon}}
            </button>
            <span style="color: #989da1; font-size: 16px; text-decoration: underline; text-decoration-color: #989da1;">{{tweet.likes}}</span>
        </div>
        <div style="display: flex; align-items: center; gap: 5px;">
            <button
                    hx-get="/tweets/{{tweet.tweet.id}}/comment?shown=false"
                    hx-target="#comment-area-{{tweet.tweet.id}}"
                    hx-swap="outerHTML"
                    hx-on::after-request="updateButtonState(this)"
                    data-tweet-id="{{ tweet.tweet.id }}"
                    style="all:unset; cursor: pointer">
                ðŸ’¬
            </button>
            <span style="color: #989da1; font-size: 16px; text-decoration: underline; text-decoration-color: #989da1;">{{tweet.comment_count}}</span>
        </div>
    </div>
    <div id="comment-area-{{tweet.tweet.id}}"></div>
</div>


<script>
    function updateButtonState(button) {
        const currentUrl = button.getAttribute('hx-get');
        const tweetId = button.getAttribute('data-tweet-id');
        const urlParams = new URLSearchParams(currentUrl.split('?')[1]);
        const isShown = urlParams.get('shown') === 'false';
        const newUrl = `/tweets/${tweetId}/comment?shown=${isShown}`;
        button.setAttribute('hx-get', newUrl);
        htmx.process(button);
    }
</script>